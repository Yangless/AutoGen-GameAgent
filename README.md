# 游戏玩家实时行为监控助手

一个基于 AutoGen 多智能体框架的游戏玩家行为监控和自动干预系统。

## 🎯 系统概述

本系统使用 MagenticOneGroupChat 管理多个专业分析工具 Agent，实现：
- **实时监控**：后台模拟并监控玩家行为
- **智能触发**：当负面指标达到预设阈值时自动触发分析
- **多智能体协作**：多个专业 Agent 协同分析和响应
- **自动干预**：根据分析结果自动执行相应的干预措施

## 🏗️ 系统架构

### 核心组件

1. **玩家行为模拟器** (`PlayerBehaviorSimulator`)
   - 模拟真实的玩家行为数据
   - 包含21种不同的玩家场景
   - 识别7种负面行为模式

2. **行为监控器** (`BehaviorMonitor`)
   - 实时监控玩家行为
   - 阈值触发机制（默认3次负面行为）
   - 维护玩家行为历史记录

3. **多智能体团队**
   - 6个专业分析和干预 Agent
   - 基于 AutoGen 的 MagenticOneGroupChat 架构

### 智能体详细说明

#### 分析类智能体

1. **情绪识别智能体** (`EmotionRecognitionAgent`)
   - **功能**：分析玩家情绪状态
   - **输入**：玩家ID和行为历史
   - **输出**：情绪标签、置信度、触发关键词

2. **流失风险评估智能体** (`ChurnRiskAgent`)
   - **功能**：预测玩家流失风险
   - **输入**：玩家ID和行为历史
   - **输出**：风险等级、风险分数、关键影响因素

3. **机器人检测智能体** (`BotDetectionAgent`)
   - **功能**：识别异常的机器人行为
   - **输入**：玩家ID和行为历史
   - **输出**：是否为机器人、置信度、检测模式

4. **玩家状态聚合智能体** (`PlayerStateAgent`)
   - **功能**：整合各种分析结果
   - **输入**：玩家ID和各项分析数据
   - **输出**：玩家核心档案快照

#### 干预类智能体

5. **参与度提升智能体** (`EngagementAgent`)
   - **功能**：执行激励和奖励操作
   - **支持操作**：发放道具、邮件奖励等
   - **输出**：操作状态和事务ID

6. **玩家引导智能体** (`GuidanceAgent`)
   - **功能**：提供引导和帮助
   - **支持操作**：弹窗提示、专属客服、攻略推送
   - **输出**：操作状态和事务ID

## 🎮 玩家场景库

系统包含丰富的玩家行为场景：

### 正常游戏行为
- 玩家登陆游戏
- 玩家打开副本
- 玩家迁城
- 玩家攻城/攻占土地
- 玩家加入家族/国家
- 玩家讨伐蛮族
- 玩家打开招募英雄
- 玩家跳转充值页面

### 负面行为指标
- 发布消极评论
- 突然不充了
- 不买月卡了
- 抽卡频率变低
- 玩家分解装备
- 玩家退出家族
- 玩家点击退出游戏

## 🛠️ 游戏功能库

系统支持的干预功能：
- 发邮件奖励
- 弹出加专属客服
- 弹幕安慰玩家
- 弹出攻略
- 推送活动通知
- 发放补偿道具
- 触发新手引导

## 🚀 快速开始

### 环境要求
- Python 3.10+
- UV 包管理器
- AutoGen 相关依赖

### 安装和运行

```bash
# 克隆项目
git clone <repository-url>
cd AutoGen-Agent

# 安装依赖（如果需要）
uv sync

# 运行系统
uv run main.py
```

### 配置说明

在实际部署时，需要配置以下组件：

1. **OpenAI 客户端**：
```python
from autogen_ext.models.openai import OpenAIChatCompletionClient

model_client = OpenAIChatCompletionClient(
    model="gpt-4",
    api_key="your-api-key"
)
```

2. **MagenticOneGroupChat 团队**：
```python
from autogen_agentchat.teams import MagenticOneGroupChat

analysis_team = MagenticOneGroupChat(
    agents=[
        emotion_agent,
        churn_agent,
        bot_agent,
        state_agent,
        engagement_agent,
        guidance_agent
    ]
)
```

## 📊 系统工作流程

1. **行为生成**：系统持续模拟玩家行为
2. **实时监控**：监控器检查每个行为是否为负面行为
3. **阈值触发**：当玩家负面行为达到阈值（默认3次）时触发分析
4. **多智能体分析**：
   - 情绪识别智能体分析玩家情绪
   - 流失风险智能体评估流失概率
   - 机器人检测智能体判断是否为异常行为
   - 状态聚合智能体整合所有分析结果
5. **自动干预**：根据分析结果执行相应的干预措施
6. **状态重置**：完成干预后重置该玩家的负面行为计数

## 🔧 自定义配置

### 调整监控阈值
```python
monitor = BehaviorMonitor(threshold=5)  # 设置为5次负面行为触发
```

### 添加新的玩家场景
```python
simulator.player_scenarios.append("新的玩家行为")
simulator.negative_behaviors.append("新的负面行为")
```

### 扩展游戏功能
```python
simulator.game_functions.append("新的游戏功能")
```

## 📈 监控输出示例

```
🎮 游戏Agent助手监控助手
==================================================
🎮 游戏Agent助手系统已初始化

🚀 开始模拟监控会话 (持续 60 秒)...

📝 玩家行为: player_3 - 玩家登陆游戏
📝 玩家行为: player_1 - 发布消极评论
📝 玩家行为: player_2 - 突然不充了
📝 玩家行为: player_1 - 不买月卡了
📝 玩家行为: player_1 - 玩家点击退出游戏
⚠️ 触发监控阈值: 玩家 player_1 负面行为达到 3 次

🔍 开始分析玩家 player_1...
📊 玩家 player_1 分析完成:
   情绪状态: 沮丧 (置信度: 0.85)
   流失风险: 高风险 (风险分数: 0.95)
   机器人嫌疑: 否 (置信度: 0.00)

🎯 为玩家 player_1 执行干预措施...
   ✅ 已为玩家发放补偿道具: success
   ✅ 已触发专属客服弹窗: success
🔄 已重置玩家 player_1 的负面行为计数
```

## 🎯 系统特点

- ✅ **实时响应**：毫秒级行为监控和分析
- ✅ **智能分析**：多维度玩家状态评估
- ✅ **自动干预**：基于分析结果的智能响应
- ✅ **可扩展性**：易于添加新的智能体和功能
- ✅ **模块化设计**：各组件独立，便于维护和测试
- ✅ **异步处理**：高效的并发处理能力

## 📝 注意事项

1. 当前版本使用模拟数据，实际部署时需要连接真实的游戏数据源
2. OpenAI API 密钥需要在生产环境中正确配置
3. 建议根据实际游戏类型调整行为场景和阈值设置
4. 系统设计支持水平扩展，可以根据玩家规模调整部署架构

## 🔮 未来扩展

- 集成真实游戏数据库
- 添加更多分析维度（社交网络分析、消费行为分析等）
- 实现更复杂的干预策略
- 添加 A/B 测试功能
- 集成机器学习模型进行预测优化